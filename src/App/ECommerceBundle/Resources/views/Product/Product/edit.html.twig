{% extends 'AppAdminBundle:Layout:admin.html.twig' %}
{% form_theme edit_form 'AppAdminBundle:Form:fields-tabs.html.twig' %}

{% block body %}
    <div class="row">
        {{ form_start(edit_form) }}
        <div class="col-lg-2">
            <section class="panel">
                <ul class="nav nav-pills nav-stacked nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#image">
                            <i class="fa fa-user"></i> Informations
                        </a>
                    </li>
                </ul>
            </section>
        </div>



            <div id="image" class="col-lg-10 tab-pane">
                <section class="panel">
                    <header class="panel-heading">
                        Images
                    </header>
                    <div class="panel-body">
                        <div class="col-sm-10">
                            <input class="form-control" type="text" id="media-autocomplete" placeholder="rechercher un média">
                            <ul class="medias" data-prototype="{{ form_widget(edit_form.medias.vars.prototype)|e }}"></ul>
                            <table class="table table-striped table-hover table-bordered" id="medias-table">
                                <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Type média</th>
                                    <th>Nom</th>
                                    <th>Apercu</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>

                                {% for key,media in edit_form.medias %}
                                <tr id="{{ key }}">
                                    <td>{{ medias[key].id }}</td>
                                    <td>{{ medias[key].type }}</td>
                                    <td>{{ medias[key].name }}</td>
                                    <td style="width:50px;">{{ medias[key]| formatImage('thumb',50) | raw }}</td>
                                    <td style="width:50px;"><a class="btn btn-danger btn-sm" onclick="deleteMedia('{{ key }}')"><i class="fa fa-trash-o"></i></a></td>
                                    {{ form_row(media) }}
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <button type="submit" class="btn btn-success">Modifier</button>
                        </div>

                    </div>
                </section>
            </div>
        </div>
        {{ form_end(edit_form) }}
    </div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>

        var collectionHolder = $('ul.medias');

            $( "#media-autocomplete" ).autocomplete({
                minLength: 0,
                source: '{{  path('media_ajax',{'type':'image'}) }}',
                select: function(event, ui) {
                    event.preventDefault();
                    console.log(ui.item.value);
                    var prototype = collectionHolder.attr('data-prototype');
                    var length = $("#medias-table tbody").children().length
                    var newForm = prototype.replace(/__name__/g, length);
                     //collectionHolder.append(newForm);
                    $("#medias-table tbody").append('<tr id="' + length + '"><td>' + ui.item.value + ' <td>' + ui.item.type + '</td><td>' + ui.item.label + '</td><td>' + ui.item.img + '</td><td><a class="btn btn-danger btn-sm" onclick="deleteMedia(' + length + ')"><i class="fa fa-trash-o"></i></a></td></tr>');
                    $("#medias-table tbody tr#" + length).append(newForm);
                    $("#app_ecommercebundle_product_form_product_medias_" + length).attr('value',ui.item.value);
                }
            })
            .data("ui-autocomplete")._renderItem = function (ul, item) {
                    return $("<li></li>").data("item.autocomplete", item)
                            .append("<a class='"+ item.value + "'></a><a>" + item.img + " " + item.value + " - " +item.label + "</a>")
                            .appendTo(ul);
            };

        function deleteMedia(id) {
            $("#medias-table tbody tr#" + id).remove();
        }

    </script>
{% endblock %}






