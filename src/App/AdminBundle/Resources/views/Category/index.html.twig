{% extends 'AppAdminBundle:Layout:admin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/appadmin/js/jstree/themes/default/style.min.css') }}" rel="stylesheet" />
{% endblock %}

{% block body %}
    <h1>Category list</h1>

    <div id="categories">
        {{ htmlTree |raw }}
    </div>
    {% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/appadmin/js/jstree/jstree.min.js') }}" ></script>
    <script src="{{ asset('bundles/appadmin/js/jstree/plugins/jstree.contextmenu.js') }}" ></script>
    <script src="{{ asset('bundles/appadmin/js/jstree/plugins/jstree.unique.js') }}" ></script>
<script>
    $(function () {
        $('#categories').jstree({
            "core" : {
                "animation" : 0,
                "check_callback" : true,
                "themes" : { "stripes" : true }

            },
            "plugins" : [ "contextmenu", "unique" ],
            "contextmenu" : {
                items : function( obj ) {
                    var menu = {};
                    menu = {
                        "create" : {
                            "separator_before"	: true,
                            "separator_after"	: false,
                            "label"				: "Créér une catégorie",
                            "action"			: function (data) {
                                var inst = $.jstree.reference(data.reference),
                                        obj = inst.get_node(data.reference);
                                inst.create_node(obj, {}, "last", function (new_node) {
                                    setTimeout(function () { inst.edit(new_node); },0);
                                });
                            }
                        }
                    }
                    return menu;
                }
            }
        })
        .bind("select_node.jstree", function (e, data) {
           // console.log(data.selected);
        })
        .bind("create_node.jstree", function (e, data) {
                    $

        })
        .bind("rename_node.jstree", function (e, data) {
            infos = {};
            infos.parentid = data.node.parent;
            infos.name = data.text
                    $.post('{{ path('category_save') }}', infos, function(resp){
                        $('#'+data.node.id).attr('id',resp.id)
                        console.log(resp.id);
                    })
            console.log("rename_node.jstree");
            console.log(data);
        });
    });

</script>
{% endblock %}